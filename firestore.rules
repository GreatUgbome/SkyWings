rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Match the app structure: artifacts/{appId}/...
    match /artifacts/{appId} {
      
      // SECURITY: Only allow specific UIDs to perform Admin actions
      function isAdmin() {
        return request.auth != null && request.auth.uid in ['YOUR_ADMIN_UID_HERE'];
      }

      // FLIGHTS: Publicly readable, writable by authenticated users (Admins)
      match /public/data/flights/{flightId} {
        allow read: if true;
        allow write: if isAdmin();
      }

      // ALERTS: Publicly readable
      match /public/data/alerts/{alertId} {
        allow read: if true;
        allow write: if isAdmin();
      }

      // PUBLIC BOOKINGS: Used for Admin dashboard and creating copies of bookings
      match /public/data/bookings/{bookingId} {
        // Admins can see all bookings
        allow read: if isAdmin();
        // Users can create bookings, but only Admins can update/delete them in the public list
        allow create: if request.auth != null;
        allow update, delete: if isAdmin();
      }

      // USER DATA: Users can only read/write their own data
      match /users/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
        
        match /{document=**} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }
    }
  }
}